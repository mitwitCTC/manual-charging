<!doctype html>
<html lang="zh-Hant-TW">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <title>充電樁人工入格</title>
</head>

<body>
    <div id="app">
        <div class="container">
            <table class="table table-hover text-center">
                <thead>
                    <tr class="h2">
                        <th scope="col">場站 Id</th>
                        <th scope="col">車位</th>
                        <th scope="col">車號</th>
                        <th scope="col">入場時間</th>
                        <th scope="col"><button type="button" class="btn btn-warning" data-bs-toggle="modal"
                                data-bs-target="#ticketModal" @click="openTicketModal('create')">新增</button>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="ticket in tickets" :key="ticket.id" class="fs-4">
                        <th scope="row">{{ticket.stationId}}</th>
                        <td>{{ ticket.spaceId }}</td>
                        <td>{{ ticket.checkPlate }}</td>
                        <td>{{ ticket.ArrivalTime }}</td>
                        <td>
                            <a href="#"><img src="./images/edit.png" alt="edit" style="width: 25px;"
                                    data-bs-toggle="modal" data-bs-target="#ticketModal"
                                    @click="openTicketModal('edit', ticket)"></a>
                            <a href="#"><img src="./images/delete.png" alt="delete"
                                    style="width: 25px; margin-left: 25px;" data-bs-toggle="modal"
                                    data-bs-target="#deleteModal" @click="openDeleteModal(ticket)"></a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- Modal -->
            <div class="modal fade" id="ticketModal" tabindex="-1" aria-labelledby="ticketModalLabel"
                aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-warning">
                            <h5 class="modal-title" id="ticketModalLabel">{{ isNewTicket ? '新增開票' : '編輯'}}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="myForm" v-if="isNewTicket" @submit.prevent="updateTicket">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="floatingSelect"
                                        aria-label="Floating label select example" required
                                        v-model="tempTicket.stationId">
                                        <option disabled>請選擇場站名稱</option>
                                        <option v-for="station in stations" :value="station.id">{{
                                            station.name }}</option>
                                    </select>
                                    <label for="floatingSelect">請選擇場站名稱</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="floatingInput"
                                        v-model="tempTicket.spaceId" required>
                                    <label for="floatingInput">請輸入車位號</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="floatingInput"
                                        v-model="tempTicket.checkPlate" required>
                                    <label for="floatingInput">請輸入車號</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="datetime-local" class="form-control" id="floatingInput" step="1"
                                        v-model="tempTicket.ArrivalTime" required>
                                    <label for="floatingInput">請輸入入場時間</label>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-secondary"
                                        data-bs-dismiss="modal">取消</button>
                                    <button type="submit" id="submitButton" class="btn btn-warning">確認</button>
                                </div>
                            </form>
                            <form id="myForm" v-else>
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="floatingSelect"
                                        aria-label="Floating label select example" required
                                        v-model="tempTicket.stationId" disabled>
                                        <option disabled>請選擇場站名稱</option>
                                        <option v-for="station in stations" :value="station.id">{{ station.name }}</option>
                                    </select>
                                    <label for="floatingSelect">請選擇場站名稱</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control" id="floatingInput"
                                        v-model="tempTicket.spaceId" required disabled>
                                    <label for="floatingInput">請輸入車位號</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="floatingInput"
                                        v-model="tempTicket.checkPlate" required>
                                    <label for="floatingInput">請輸入車號</label>
                                </div>

                                <div class="form-floating mb-3">
                                    <input type="datetime-local" class="form-control" id="floatingInput" step="1" v-model="tempTicket.ArrivalTime" required disabled>
                                    <label for="floatingInput">請輸入入場時間</label>
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-secondary"
                                        data-bs-dismiss="modal">取消</button>
                                    <button type="submit" id="submitButton" class="btn btn-warning"
                                        @click="updateTicket">確認</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-warning">
                            <h5 class="modal-title" id="ticketModalLabel">確認刪除</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="myDeleteForm" @submit.prevent="deleteTicket">
                                <p v-if="tempTicket.stationId == 1">場站：<span>測試</span></p>
                                <p v-if="tempTicket.stationId == 396">場站：<span>正心</span></p>
                                <p v-if="tempTicket.stationId == 260">場站：<span>林森</span></p>
                                <p v-if="tempTicket.stationId == 433">場站：<span>南屯五權</span></p>
                                <p>車號：<span>{{ tempTicket.checkPlate }}</span></p>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-outline-secondary"
                                        data-bs-dismiss="modal">取消</button>
                                    <button type="submit" id="submitButton" class="btn btn-warning">確認</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.9.1/axios.min.js'
        integrity='sha512-Xk3wWei2TGrsh9kDSBKUMIjw/86sLUvhtnv9f7fOuIwhhiUTKz8szkWkzHthrM5Bb3Bu9idSzkxOrkzhcneuiw=='
        crossorigin='anonymous'></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vee-validate/4.5.8/vee-validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vee-validate/rules@4.5.8/dist/vee-validate-rules.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vee-validate/i18n@4.5.8/dist/vee-validate-i18n.min.js"></script>
    <script type="module" src="./all.js"></script>

    <!-- <script>
        const { createApp } = Vue;
        let ticketModal = null;
        let deleteModal = null;

        const Api = 'https://398a-122-116-23-30.ngrok-free.app'

        createApp({
            data() {
                return {
                    tickets: [],
                    tempTicket: {},
                    stations: [
                        {
                            stationName: '測試',
                            stationId: 1
                        },
                        {
                            stationName: '正心',
                            stationId: 396
                        },
                        {
                            stationName: '林森',
                            stationId: 260
                        },
                        {
                            stationName: '南屯五權',
                            stationId: 433
                        },
                    ]
                    ,
                    isNewTicket: true,
                }
            },
            methods: {
                getInfos() {
                    const getInfosApi = `${Api}/charging_toon/carIn`;
                    axios
                        .get(getInfosApi)
                        .then((response) => {
                            this.tickets = response.data;
                        })
                },
                openTicketModal(status, ticket) {
                    ticketModal.show();
                    if (status === 'create') {
                        this.isNewTicket = true;
                        this.tempTicket = {};
                    } else if (status === 'edit') {
                        this.isNewTicket = false;
                        this.tempTicket = JSON.parse(JSON.stringify(ticket));
                    }
                },
                updateTicket() {
                    let updateTicketApi = `${Api}/charging_toon/createCarIn`;
                    if (this.isNewTicket) {
                        if (this.tempTicket.ArrivalTime !== null || this.tempTicket.ArrivalTime != "" || this.tempTicket.ArrivalTime !== undefined) {
                            this.tempTicket.ArrivalTime = this.tempTicket.ArrivalTime.split('T')[0] + ' ' + this.tempTicket.ArrivalTime.split('T')[1];
                        };
                        axios
                            .post(updateTicketApi, { target: this.tempTicket })
                            .then((response) => {
                                alert(response.data.message)
                                this.getInfos();
                            })
                        ticketModal.hide();
                    } else {
                        updateTicketApi = `${Api}/charging_toon/updatePlate/${this.tempTicket.id}`;
                        axios
                            .put(updateTicketApi, { target: this.tempTicket.checkPlate })
                            .then((response) => {
                                alert(response.data.message);
                                this.getInfos();
                            })
                        ticketModal.hide();
                    }
                },
                openDeleteModal(ticket) {
                    deleteModal.show();
                    this.tempTicket = JSON.parse(JSON.stringify(ticket));
                },
                deleteTicket(){
                    let deleteTicketApi = `${Api}/charging_toon/deleteCarIn/${this.tempTicket.id}`;
                    axios
                    .put(deleteTicketApi)
                    .then((response) => {
                        deleteModal.hide();
                        alert(response.data.message);
                        this.getInfos();
                    });
                }
            },
            mounted() {
                this.getInfos();
                ticketModal = new bootstrap.Modal('#ticketModal');
                deleteModal = new bootstrap.Modal('#deleteModal');
            }
        }).mount('#app')
    </script> -->


</body>

</html>